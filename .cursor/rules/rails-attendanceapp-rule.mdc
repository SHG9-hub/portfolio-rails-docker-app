---
description: 
globs: 
alwaysApply: false
---
**Dockerç’°å¢ƒã§ã®å‹¤æ€ ç®¡ç†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãƒ«ãƒ¼ãƒ«**

## Dockerç’°å¢ƒå‰æ
ã™ã¹ã¦ã®Railsã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã®å½¢å¼ã§å®Ÿè¡Œ:
```bash
docker compose run --rm web [command]
```

## ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³ âœ…
- âœ… Rails 7.1.5 + Ruby 3.2.2
- âœ… PostgreSQL (Docker)
- âœ… Devise gem ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- âœ… RSpec gem ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿  
- âœ… Dockerç’°å¢ƒæ§‹ç¯‰æ¸ˆã¿
- âœ… åŸºæœ¬çš„ãªgemãƒ•ã‚¡ã‚¤ãƒ«è¨­å®šå®Œäº†

## å‹¤æ€ ç®¡ç†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ è¦ä»¶å®šç¾©æ›¸

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ¦‚è¦
* **åç§°**: ã‚·ãƒ³ãƒ—ãƒ«å‹¤æ€ ç®¡ç†ã‚¢ãƒ—ãƒª
* **ç›®çš„**: å¾“æ¥­å“¡ãŒè‡ªèº«ã®å‡ºé€€å‹¤æ™‚é–“ã‚’è¨˜éŒ²ã—ã€å‹¤å‹™å±¥æ­´ã‚’ç¢ºèªã§ãã‚‹ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### 2. æ©Ÿèƒ½è¦ä»¶

#### 2.1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† (Deviseä½¿ç”¨)
* **UY-001**: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã®æ–°è¦ç™»éŒ²
* **UY-002**: ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½  
* **UY-003**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½

#### 2.2. å‹¤æ€ ç®¡ç†æ©Ÿèƒ½
* **AT-001**: å‡ºå‹¤æ‰“åˆ»ï¼ˆé‡è¤‡æ‰“åˆ»é˜²æ­¢ï¼‰
* **AT-002**: é€€å‹¤æ‰“åˆ»ï¼ˆå‡ºå‹¤å¾Œã®ã¿å¯èƒ½ï¼‰
* **AT-003**: æ‰“åˆ»å±¥æ­´è¡¨ç¤ºï¼ˆæ—¥åˆ¥ãƒ»æœˆåˆ¥ï¼‰
* **AT-004**: å‹¤å‹™æ™‚é–“è‡ªå‹•è¨ˆç®—

### 3. é–‹ç™ºã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆï¼ˆå„ªå…ˆé †ï¼‰

#### ğŸ”¥ Phase 1: Deviseè¨­å®šå®Œäº†
```bash
# DeviseåˆæœŸè¨­å®š
docker compose run --rm web rails generate devise:install
docker compose run --rm web rails generate devise User
docker compose run --rm web rails db:migrate

# RSpecè¨­å®š
docker compose run --rm web rails generate rspec:install
```

#### ğŸ”¥ Phase 2: å‹¤æ€ ãƒ¢ãƒ‡ãƒ«ä½œæˆ
```bash
# Attendanceãƒ¢ãƒ‡ãƒ«ç”Ÿæˆ
docker compose run --rm web rails generate model Attendance user:references attendance_time:datetime leaving_time:datetime
docker compose run --rm web rails db:migrate
```

#### ğŸ”¥ Phase 3: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒ»ãƒ“ãƒ¥ãƒ¼ä½œæˆ  
```bash
# ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç”Ÿæˆ
docker compose run --rm web rails generate controller Attendances index create update

# ãƒ«ãƒ¼ãƒˆè¨­å®š
# resources :attendances, only: [:index, :create, :update]
```

#### ğŸ”¥ Phase 4: ãƒ†ã‚¹ãƒˆä½œæˆ
```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker compose run --rm web bundle exec rspec
```

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

#### Users ãƒ†ãƒ¼ãƒ–ãƒ« (Devise)
- id, email, encrypted_password, created_at, updated_at

#### Attendances ãƒ†ãƒ¼ãƒ–ãƒ«  
- id, user_id, attendance_time, leaving_time, created_at, updated_at

### 5. Dockerç’°å¢ƒã‚³ãƒãƒ³ãƒ‰é›†

#### åŸºæœ¬æ“ä½œ
```bash
# ç’°å¢ƒèµ·å‹•
docker compose up

# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•  
docker compose up -d

# ãƒ­ã‚°ç¢ºèª
docker compose logs web

# ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢
docker compose down

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ
docker compose run --rm web rails db:drop db:create db:migrate
```

#### é–‹ç™ºã‚³ãƒãƒ³ãƒ‰
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
docker compose run --rm web rails db:migrate
docker compose run --rm web rails db:rollback

# ã‚·ãƒ¼ãƒ‰å®Ÿè¡Œ
docker compose run --rm web rails db:seed

# ã‚³ãƒ³ã‚½ãƒ¼ãƒ«
docker compose run --rm web rails console

# ãƒ«ãƒ¼ãƒˆç¢ºèª
docker compose run --rm web rails routes

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ  
docker compose run --rm web bundle exec rspec
docker compose run --rm web bundle exec rspec spec/models/
docker compose run --rm web bundle exec rspec spec/controllers/
```

#### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
```bash
# Gemfileå¤‰æ›´å¾Œ
docker compose build web
docker compose run --rm web bundle install

# ã‚¢ã‚»ãƒƒãƒˆé–¢é€£
docker compose run --rm web rails assets:precompile
docker compose run --rm web rails assets:clobber

# PIDãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
docker compose run --rm web rm -f tmp/pids/server.pid
```

### 6. å“è³ªç®¡ç†

#### ãƒ†ã‚¹ãƒˆæ–¹é‡
- Model Spec: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆ
- Controller Spec: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å‡¦ç†ã®ãƒ†ã‚¹ãƒˆ  
- System Spec: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- Devise ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ä½¿ç”¨
- èªè¨¼å¿…é ˆãƒšãƒ¼ã‚¸ã®è¨­å®šï¼ˆbefore_action :authenticate_user!ï¼‰
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é©åˆ‡ãªãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

### 7. é€²æ—ç®¡ç†

**ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Phase 1å®Ÿè¡Œå¾…ã¡

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: 
1. Deviseè¨­å®šã®å®Œäº†ç¢ºèª
2. Userèªè¨¼ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ  
3. Attendanceãƒ¢ãƒ‡ãƒ«ã®ä½œæˆ

**å®Œäº†æ¡ä»¶**:
- ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹
- Dockerç’°å¢ƒã§æ­£å¸¸å‹•ä½œ
- åŸºæœ¬çš„ãªå‹¤æ€ æ©Ÿèƒ½ãŒä½¿ç”¨å¯èƒ½

---

**é‡è¦**: å¿…ãšDockerç’°å¢ƒã§ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚’å¾¹åº•ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®Railså®Ÿè¡Œã¯é¿ã‘ã¦ãã ã•ã„ã€‚