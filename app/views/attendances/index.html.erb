<div class="dashboard-container">
  <div class="user-info-header">
    <div class="user-greeting">
      <span class="greeting-text">こんにちは、<%= current_user.email.split('@').first %>さん</span>
    </div>
    <div class="header-actions">
      <%= link_to "ログアウト", destroy_user_session_path, data: { "turbo-method": :delete }, class: "btn btn-danger btn-sm" %>
    </div>
  </div>

  <div class="page-header">
    <h1 class="page-title">勤怠ダッシュボード</h1>
    <p class="page-subtitle">日々の勤怠記録を管理しましょう</p>
  </div>

  <div class="dashboard-actions">
    <%= link_to "今すぐ打刻", new_attendance_path, class: "btn btn-primary btn-large" %>
  </div>

  <div class="card">
    <div class="card-header">
      <h3 class="card-title">年月選択</h3>
    </div>
    <div class="card-body">
      <%= form_with url: attendances_path, method: :get, local: true, class: "filter-form" do |form| %>
        <div class="form-row">
          <div class="form-group">
            <%= form.label :year, "年", class: "form-label" %>
            <%= form.number_field :year, 
                value: @selected_year, 
                min: current_user.attendances.first&.check_in&.year || Date.current.year, 
                max: Date.current.year, 
                class: "form-input",
                onchange: "this.form.submit();" %>
          </div>
          <div class="form-group">
            <%= form.label :month, "月", class: "form-label" %>
            <%= form.select :month, 
                options_for_select((1..12).map { |m| ["#{m}月", m] }, @selected_month), 
                { prompt: "月を選択" }, 
                { class: "form-input", onchange: "this.form.submit();" } %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <h3 class="card-title"><%= @selected_year %>年<%= @selected_month %>月の勤怠記録</h3>
    </div>
    <div class="card-body">
      <% if @attendances.present? %>
        <div class="table-container">
          <table class="attendance-table">
            <thead>
              <tr>
                <th>出勤日</th>
                <th>出勤時間</th>
                <th>退勤日</th>
                <th>退勤時間</th>
                <th>勤務時間</th>
              </tr>
            </thead>
            <tbody>
              <% @attendances.each do |attendance| %>
                <tr class="<%= 'incomplete' if attendance.check_out.nil? %>">
                  <td>
                    <%= link_to (attendance.check_in.strftime("%Y年%m月%d日") if attendance.check_in), attendance_path(attendance), class: "attendance-link" %>
                  </td>
                  <td>
                    <%= attendance.check_in.strftime("%H:%M") if attendance.check_in %>
                  </td>
                  <td>
                    <%= attendance.check_out.strftime("%Y年%m月%d日") if attendance.check_out %>
                  </td>
                  <td>
                    <%= attendance.check_out.strftime("%H:%M") if attendance.check_out %>
                  </td>
                  <td class="working-hours">
                    <% if attendance.working_hours %>
                      <span class="hours-badge"><%= sprintf("%.2f", attendance.working_hours) %> 時間</span>
                    <% else %>
                      <span class="incomplete-badge">勤務中</span>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <div class="card summary-card">
          <div class="card-header">
            <h3 class="card-title"><%= @selected_year %>年<%= @selected_month %>月の勤務時間</h3>
          </div>
          <div class="card-body">
            <div class="table-container">
              <table class="attendance-table">
                <thead>
                  <tr>
                    <th>項目</th>
                    <th>値</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>総勤務時間</td>
                    <td><%= sprintf("%.2f", @attendances.total_working_hours) %> 時間</td>
                  </tr>
                  <tr>
                    <td>出勤日数</td>
                    <td><%= @attendances.count %> 日</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      <% else %>
        <div class="empty-state">
          <div class="empty-icon">📅</div>
          <h4><%= @selected_year %>年<%= @selected_month %>月の勤怠記録がありません</h4>
          <p>新しい勤怠記録を作成しましょう</p>
          </div>
      <% end %>
    </div>
  </div>
</div>
